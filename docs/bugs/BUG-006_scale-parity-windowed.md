# BUG-006 — Непоследовательный scale/форм-фактор в оконном режиме

- **Area:** Responsive / Scale
- **Severity:** High
- **Status:** IN_PROGRESS
- **Date:** 2025-12-22
- **Reporter:** Codex (feature/profile-auth-v2.3.1)
- **Spec:** docs/iterations/ui-scale-normalization-v2.3.1/spec.md

## Problem
При работе в оконном режиме (уменьшенное окно, масштаб 80–90%, внешние мониторы с отличным DPR) UI теряет форм-фактор: карточки и боксы “плывут”, отступы/границы меняют толщину, overlay и status/footer смещаются. В full window выглядит корректнее.

## Steps to Reproduce
1) Открыть панель в browser window < 1440px ширины или с zoom 80–90%.
2) Перейти на `/dashboard` или `/dashboard/content/all`.
3) Сравнить отступы/толщину границ/scale с full-window состоянием, покрутить scroll.

## Expected
- Единый визуальный масштаб и пропорции (толщина бордеров, размеры карточек/чипов) независимо от windowed/fullscreen и DPR.
- Overlay/footers остаются выровненными, без “плавающих” отступов.

## Actual
- В windowed/zoom режимах элементы выглядят иначе: бордеры тоньше/толще, карточки разъезжаются, footer/topbar иногда наезжают или имеют разный зазор.
- Наблюдается дрейф при `transform/scale`-зависимых блоках (см. также BUG-002).

## Notes / Suspected cause
- Использование `transform: scale` в отдельных контейнерах + sticky элементов без учёта DPR.
- Жёсткие px-значения для бордеров/теней вместо rem/clamp, отсутствие согласованной математики для scale.
- Связано с BUG-002 (оконный режим ломает scale) — этот баг дополняет детализацией проблемы форм-фактора.
- Глобальный `html` zoom/transform дополнительно масштабирует UI поверх токенов (`--ax-scale`), что усиливает дрейф в windowed.
- Попытка адаптивного `--ax-ui-scale` (0.9/1.0) убрана: ломает базовый 0.8 масштаб и увеличивает элементы.

## Proposed next step
- Убрать/минимизировать `transform: scale` в layout-контейнерах; перейти на clamp/rem токены.
- Проверить sticky/portal слои без наследования масштабов.
- Добавить визуальные снапшоты для разных DPR/zoom (Playwright/Loki) и привести размеры к токенам.
- Ввести адаптивный `--ax-ui-scale`: большие экраны используют меньший масштаб, для windowed — scale 1, чтобы не “плыли” сетки/карточки.
- Перейти на контрольный “layout lock” (фиксированный дизайн-ширина + управляемый scale), чтобы избежать триггера брейкпоинтов при windowed.
