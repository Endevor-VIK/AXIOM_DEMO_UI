<!--
AXS_HEADER_META:
  id: AXS.AXUI.AGENTS_MD
  title: "AGENTS — системная инструкция для работы в AXIOM WEB CORE (ui)"
  status: ACTIVE
  mode: Doc
  goal: "Document"
  scope: "AXIOM WEB CORE UI"
  lang: ru
  last_updated: 2026-02-05
  editable_by_agents: true
  change_policy: "Update via AgentOps log"
-->

<!-- AGENTS.md -->

# AGENTS — системная инструкция для работы в AXIOM WEB CORE (ui)

## Назначение
Этот документ задает единые правила работы для любых задач: принятие, анализ, правки, QA, логирование и коммиты. Цель — быстро включать агентов в контекст и держать стабильный процесс.

> В чате всегда писать на RU.  
> Обращение к пользователю: **CREATOR**.

---

## 0) Golden Rules
1) Ops-first: любая работа фиксируется в `ops/agent_ops/...`.
2) Не делать разрушительных действий без запроса CREATOR.
3) Коммитить только свои изменения.
4) Каждый `.md` должен иметь шапку `AXS_HEADER_META`.
5) Для изменений в submodule — коммиты только внутри submodule.

---

## 1) Коммуникация с CREATOR
- Пиши на русском, коротко и по делу.
- Всегда фиксируй: цель, контекст, что изменено, что нужно проверить.
- После заметных визуальных правок — проси фидбэк и скрин.
- Если видишь неожиданные изменения в репозитории — **стоп** и спроси CREATOR.
- Не выполняй разрушительные действия без прямого запроса.

**Универсальные вопросы:**
1) Какая цель и критерий результата?  
2) Какой экран/route/сценарий?  
3) Какое окно/масштаб/режим?  
4) Нужен скрин с `?debug=1`?  

---

## 2) Карта проекта (где что лежит)

### Управление задачами и логами
- Общие правила: `ops/agent_ops/README.md`
- Логи задач: `ops/agent_ops/logs/`  
  Найди актуальный лог по последнему времени и статусу.

### Итерации и спеки
- Итерации: `docs/iterations/`
- Для каждой задачи обычно есть `spec.md`, assets и README.

### Баги
- Индекс и карточки: `docs/bugs/`

### Скриншоты
- Базовые и баг‑пакеты: `docs/iterations/<iteration>/assets/screenshots/`
- Условия съемки описываются в `README.md` папки screenshots.

### Код
- Роутинг: `app/routes/`
- Компоненты: `components/`
- Стили: `styles/`
- Библиотеки/утилиты: `lib/`
- Публичные данные: `public/data/`
- Легаси‑контент: `src/features/`
- Dev‑скрипты: `scripts/devtools/` (смотри `scripts/devtools/README.md`)

---

## 3) Архитектура проекта (обзор)

### Точка входа
- `app/main.tsx`: инициализация приложения, роутер, `ScaleViewport`, `AuthGate`.

### Layout shell
- `app/routes/_layout.tsx`: header, ticker, main, footer, user menu.
- Portal‑root: `#ax-modal-root` создается в `components/ScaleViewport.tsx`.

### Роутинг
- `/dashboard/*`: `app/routes/dashboard/*`
- Контент‑хаб: `app/routes/dashboard/content/*`
- Новости: `app/routes/dashboard/news/*`
- Аудит/роадмап: `app/routes/dashboard/audit/*`, `app/routes/dashboard/roadmap/*`
- Логин: `app/routes/login/*`
- Легаси Reader: `src/features/content/pages/ReaderPage.tsx`

### Данные
- VFS‑слой: `lib/vfs/index.ts` читает манифесты из `public/data/*`
- Новости: `public/data/news/*`
- Контент: `public/data/content/*`
- Audit/Roadmap: `public/data/audits/*`, `public/data/roadmap/*`

### Два пайплайна контента
- Новый: `app/routes/dashboard/content/*` + `lib/vfs/*` + `public/data/content/*`
- Легаси Reader: `src/features/content/*` + `public/content-html/*`

### Дизайн‑система
- Базовые токены/компоненты: `ax-design/tokens.css`, `ax-design/components.css`
- Проектные стили: `styles/app.css`, `styles/red-protocol-overrides.css`

### Scale‑система
- Логика: `lib/ui/scaleManager.ts`
- Canvas: `components/ScaleViewport.tsx`
- CSS переменные: `styles/app.css`

### UI‑модули
- Меню пользователя: `components/UserMenuDropdown.tsx`
- Венки/каунтеры: `components/counters/*`, `styles/counter-wreath.css`
- Ticker: `components/news/HeadlinesTicker.tsx`, `styles/ticker.css`

---

## 4) Процесс работы

### 4.1 Принять задачу
1) Прочитать актуальный лог в `ops/agent_ops/logs/`.
2) Найти связанный spec в `docs/iterations/`.
3) Уточнить цель и критерий готовности у CREATOR.
4) Зафиксировать вводные в логе (Step A).

### 4.2 Сбор данных
- Запросить скриншоты и параметры окружения.
- Если есть `debug=1` — использовать его.

### 4.3 Правки
- Делать минимальные изменения.
- Избегать больших рефакторингов без согласования.
- Двигаться итеративно: одна гипотеза → одна правка → один тест.

### 4.4 QA
- Просить CREATOR проверить изменения.
- Фиксировать результат в Step D (PASS/FAIL/SKIP).

### 4.5 Фиксация
1) Обновить лог (Step B/D/E).  
2) Сделать атомарный коммит.  
3) Сообщить CREATOR, что проверить.  

---

## 5) Логи (обязательны)
Записывать в лог:
- Step A: вход/контекст/фидбэк
- Step B: изменения (что и где)
- Step D: QA (PASS/FAIL/SKIP)
- Step E: коммиты (hash + файлы)

Формат:
```
- YYYY-MM-DDTHH:MM:SS+TZ — Действие: ... → Результат: OK
```

---

## 6) Git и коммиты
- Коммиты маленькие и атомарные.
- Не использовать `--amend` без запроса CREATOR.
- Префиксы: `fix(...)`, `feat(...)`, `docs(...)`, `chore(...)`, `chore(agent-ops)`.
- После коммита обновлять Step E.

---

## 7) Скриншоты и артефакты
- Скриншоты класть в `docs/iterations/<iteration>/assets/screenshots/`.
- README скринов должен описывать условия съемки и замечания.
- Новые баг‑пакеты обязательно фиксировать в README.

---

## 8) Долгосрочные автономные сессии (рефакторинг, билд, большие задачи)

### Общие принципы
- Разбивай работу на этапы (Phase 1/2/3).
- Каждый этап завершай логом + коммитом.
- Сохраняй стабильность: фичефлаги, минимальные правки, обратимость.

### Планирование и контроль рисков
- В начале сформулируй краткий план и риски.
- После каждого этапа делай короткий отчет для CREATOR.
- Если тесты от CREATOR будут только в конце — расширь самопроверку и лог.

### Рефакторинг
- Сначала карта файлов и зависимостей.
- Определи инварианты (что не должно измениться).
- Рефакторить частями, не ломая сборку.
- На каждом шаге — минимальный diff и фиксация.

### Сборка и проверки
- Проверяй `scripts/devtools/README.md` и `package.json` для актуальных команд.
- Если тесты/билды не запускались — явно указать это в отчете.
- При сборках фиксируй результаты в Step D.

### Работа с фидбэком
- Запрашивай финальное тестирование у CREATOR.
- Описывай, что именно нужно проверить и где.

---

## 9) Обязательный дневной чек‑лист
1) Прочитать лог и материалы задачи.
2) Уточнить вводные у CREATOR.
3) Внести минимальные правки.
4) Зафиксировать в логе.
5) Закоммитить.
6) Запросить проверку.

---

## 10) Если задача не ясна
Коротко спросить уточнение у CREATOR.  
Не пытаться “угадывать” критичные UX‑решения.
